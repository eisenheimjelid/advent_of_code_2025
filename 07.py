"""ðŸŽ„ Solution for Day 7 of Advent of Code 2025 ðŸŽ„

Usage:

uv run adventofcode run 07.py
"""

from collections import defaultdict

inp = """......................................................................S......................................................................
.............................................................................................................................................
......................................................................^......................................................................
.............................................................................................................................................
.....................................................................^.^.....................................................................
.............................................................................................................................................
....................................................................^...^....................................................................
.............................................................................................................................................
...................................................................^.^...^...................................................................
.............................................................................................................................................
..................................................................^...^...^..................................................................
.............................................................................................................................................
.................................................................^.....^.^.^.................................................................
.............................................................................................................................................
................................................................^.^.^.^...^.^................................................................
.............................................................................................................................................
...............................................................^.^.^.^.^.....^...............................................................
.............................................................................................................................................
..............................................................^.^.^.^.....^.^.^..............................................................
.............................................................................................................................................
.............................................................^.^...^...^.^...^.^.............................................................
.............................................................................................................................................
............................................................^.^.^.^.^.^...^.^.^.^............................................................
.............................................................................................................................................
...........................................................^...^.^.......^.^...^.^...........................................................
.............................................................................................................................................
..........................................................^.^...^.^.^.^.^...^.^...^..........................................................
.............................................................................................................................................
.........................................................^.^.^...^.^.^.^.^.^.^.^...^.........................................................
.............................................................................................................................................
........................................................^.^.^.........^.^.^...^.....^........................................................
.............................................................................................................................................
.......................................................^.^.^...^...^.....^...^.^...^.^.......................................................
.............................................................................................................................................
......................................................^.^.......^.......^.......^.....^......................................................
.............................................................................................................................................
.....................................................^.^.^.....^.^.^.....^.^.^.^.^...^.^.....................................................
.............................................................................................................................................
....................................................^.^...^...^.^.^.^.^...^.....^.......^....................................................
.............................................................................................................................................
...................................................^.^.^.^.^.^...^...^.^.^.^.^.^.....^...^...................................................
.............................................................................................................................................
..................................................^.^.^.^...^.^...^...^.^.....^.^...^.....^..................................................
.............................................................................................................................................
.................................................^.^.......^.^.....^...^.^...^.^...^.^...^.^.................................................
.............................................................................................................................................
................................................^...^.^.^.^.....^.^.^.^.^.^.^.....^.........^................................................
.............................................................................................................................................
...............................................^.......^.^...^.^...^.^.^.^.^...^.^...^.^.^.^.^...............................................
.............................................................................................................................................
..............................................^...^.^...^...^.^.......^.^...^.^.^.^.^.....^.^.^..............................................
.............................................................................................................................................
.............................................^...^.^.^...^.....^...^...^.^...^...^.^.......^.^.^.............................................
.............................................................................................................................................
............................................^.^.^...^.^...^...^.^.....^.^.^.^.^.^.^.^.^.^.^.^.^.^............................................
.............................................................................................................................................
...........................................^.^.^...^.^.....^.^.^...^.......^.^.^.^.^.....^...^.^.^...........................................
.............................................................................................................................................
..........................................^.^.^.^.^.^.^...^.^.^.^.^.^.^...^.^.^.^.^.^.....^.^.^.^.^..........................................
.............................................................................................................................................
.........................................^.....^.^.^...^.^.^.....^.^...^.^...^.^.^.^...^.^.^.^.^...^.........................................
.............................................................................................................................................
........................................^.^...^.......^.^.....^.^.^.^.^.^.^.^.^...^.^.^.^.^.^...^.^.^........................................
.............................................................................................................................................
.......................................^...^.....^.......^.^.^...^.^.^.^.^.....^...^.^.^.^.^.^.^.^.^.^.......................................
.............................................................................................................................................
......................................^.........^...^.^...^.^.^.^.^...^...^.^.^.^.^...^.^.^.....^...^.^......................................
.............................................................................................................................................
.....................................^.^.....^.^.^.^.^.^.^.^.^...^.......^.^.^.....^.......^.^.......^.^.....................................
.............................................................................................................................................
....................................^.^...^.....^.^.^...^.....^.^.^.^.^.^...^.^...^.....^.^.^.^.......^.^....................................
.............................................................................................................................................
...................................^.^.^.^...^.^.^.^.^.^.^.^.^.....^.^.^.^.....^.^.....^.......^.^.^...^.^...................................
.............................................................................................................................................
..................................^.^.^.^...^.^.^.^.^.^.^.^.^.^.....^.....^.^...^.^.^.....^.^.^.^.^.^...^.^..................................
.............................................................................................................................................
.................................^...^.^.^...^...^...^.^.^.^.^.....^.^.^...^.^.....^.^.^.^.....^.^.^.^.^.^.^.................................
.............................................................................................................................................
................................^.^.^...^.........^.^.^...^.^.^.^...^.^.^.^.^.^...^...^.^.^.^.^.^.^.^.^...^.^................................
.............................................................................................................................................
...............................^.^.^.^.^.^.....^.^.^.^...^...........^.....^.....^.^.......^.^.^.....^.^.^...^...............................
.............................................................................................................................................
..............................^.^.^.^.^.^.^...^.^.^.....^.^.....^...^...^.^.^.^...^.^...^.^...^.......^...^.^.^..............................
.............................................................................................................................................
.............................^...^.^.....^.^.^.....^.^...^.^...^.^...^...^.^...^.^...^...^...^.^.^.....^.....^.^.............................
.............................................................................................................................................
............................^.^.....^.^.^.....^.^...^.^...^.....^.^...^...^.^.^...^...^.^.^...^.^.^.^.^.^...^...^............................
.............................................................................................................................................
...........................^...^.^.^...^.^.^.......^.^.^...^.^.^.^.^...^...^.^.^...^.^.^.^.^.^.^.^.^.^...^...^...^...........................
.............................................................................................................................................
..........................^.^.^.^.^...^.^.^.....^.^...^.....^...^...^...^.^.^.....^...^.........^.^.^...^.^.^.^.^.^..........................
.............................................................................................................................................
.........................^...^.^.......^...^.......^...^.....^.^.^...^.....^...^...^...^.^...^.^.^.^...^.....^...^.^.........................
.............................................................................................................................................
........................^...^...^.^...^.^...^.^.^.^...^...^.^.^...^...^.^.^...^.....^...^.^.^.^.^...^.^.^.^.^...^...^........................
.............................................................................................................................................
.......................^...^.^...^...^.^.^.^...^.^...^.....^.^.^.^.^...^.^.^.^.^.........^.^.^.^.^.^.^.^...^.^...^...^.......................
.............................................................................................................................................
......................^...^.^.^.^.^.^.^.^.^.^...^.^...^...^.^...^...^.......^...^.....^.^.^...^.^.^.^.^.^.^.^.^.^.^.^.^......................
.............................................................................................................................................
.....................^...^.....^.^...^.^.^...^.^.^.^.^.^.^.^...^...^.^.^.^...........^.^.......^.....^.......^...^.^.^.^.....................
.............................................................................................................................................
....................^.^.^...^.^...^.^.....^.^.^.........^...^.^...^.^.....^.^.^.....^.......^.^.^...^.^.^.^.......^.^.^.^....................
.............................................................................................................................................
...................^.^.^.^.....^.^.^...^.^.^...^.^.^.^.^.^.^.^.^.......^.^.^.^.^.^...^.^.^.^...^.^.^...^.^...^...^.^.^.^.^...................
.............................................................................................................................................
..................^.....^.^...^.^.^.^.^.^.^...^.^.........^.^.^.^.^...^.^...^.......^.^.^.^.^.....^.^.^.^.^.^.^.^.^...^.^.^..................
.............................................................................................................................................
.................^...^.^.^.^.^.^.^...^.^...^.^.^...^.^...^.^.^...^.^...^...^.^...^.^...^.^...^...^.....^.^.....^.....^...^.^.................
.............................................................................................................................................
................^.....^.......^.^.^.^.^...^.^...^.^.^.^.^.....^.^...^.^.^.......^.^.^.^.^.^.^.^.^.^.^.^...^.^.^.^.^...^.^.^.^................
.............................................................................................................................................
...............^.....^.^...^.^.^.^.^...^.........^...^.^.^.^...^.^.^.^.^...^...^.^.^.^...^.^.^.^.^.^.^...^.^.....^.^.^.^.^.^.^...............
.............................................................................................................................................
..............^.^.^...^...^.^.^.^.^.^.^.^.^.^.^.^.^.^.....^.^.....^.^.^.^.^...^.^.^.^.^.^.^.^...^.^.^.^.^.^.^.^...^...^...^.^.^..............
.............................................................................................................................................
.............^.^.^.^.....^.^.^...^.....^.^.^.......^...^.^.^.^.^.^.^.^.^.^.^.^.^.^.....^.^.^...^...^.^.......^...^...^.^.^...^.^.............
.............................................................................................................................................
............^.^.^.....^.^.^.^.^...^.^.^...^.^...^.^.^.^.^.....^.^...^.^.^.^...^.......^...^...^.^.^.^.^...^.^.^.^.^.^.^.^.^...^.^............
.............................................................................................................................................
...........^.^...^.^...^.^.^...^.^.^.^.^.^.....^...^.^.....^...^...^.^.^.^...^.^.^.^.^...^.....^...^.^...^.....^.....^...^...^.^.^...........
.............................................................................................................................................
..........^.^.^.^.^.......^.....^...^...^...^...^...^.....^.^.^.^.^.....^.^...^.^.^.^.^.....^.^...^.^.^.^.....^.^.^.^.^.^...^...^.^..........
.............................................................................................................................................
.........^.^.^...^.^.^.^.^.^.^.^.^.........^.^...^...^.....^.^.^.^.^.^.^.^.^.......^.^.^.^.^.^...^...^.^...^.^.^.^.^.^...^.^.^...^.^.........
.............................................................................................................................................
........^.^.....^.^.^.....^.^.^...^.^...^.^.^.....^...^.^.^...^.^.^.^.^.^.....^.....^.^.^.^...^.^...^.^.....^.....^...^.^.....^.^...^........
.............................................................................................................................................
.......^...^.^.......^.^...^.^...^.^...^.....^.^.^.^.^.^.^.^...^.^.^...^...^.^.^.^.^...^...^...^.^.^...^.^...^.^.^.^.^.^.^.^.^...^.^.^.......
.............................................................................................................................................
......^.......^.....^...^...^.^.....^.^...^.....^.^.^.^.^.^...^...^...^.^...^...^.........^.^...^.......^.^.^.^...^.....^.^.^.^.....^.^......
.............................................................................................................................................
.....^.^...^.^.^.....^...^.^...^.^...^.^.^.^.^.^.^.^.^.....^...^.......^.....^.^.^...^...^.^.^...^.^.^.......^.^.^.^...^...^.^.^.^.^.^.^.....
.............................................................................................................................................
....^.^.^.....^.^.^.^.^.^.^.....^.^.^.^.....^...^.........^.^.........^.^.^.^.^.^.^...^.^.^.^...^.^.^...^.^.^.....^...^.......^.^.^.^...^....
.............................................................................................................................................
...^.^.....^.^...^.^.^.^.^.^.^.....^.^.......^...^...^...^.^...^...^.^.^.^.^.^.^.^...^.^.^.^.^...^.^.^.^.....^.^.^.^.^.^.^.^.^.^.^...^...^...
.............................................................................................................................................
..^.^.^.^...^...^.......^...^.^...^.^.....^...^.^.^...^...^.....^...^.....^.^.^.^.^...^.^.^.^.^.^.^.^...^.^.^.^.^.^.^.^...^.^.....^.^...^.^..
.............................................................................................................................................
.^.^.^.....^.........^.^.......^.^.^.^...^.^.^.^.........^.^.^.......^.^.......^.^.^.^.^.^.^...^...^...^.^.^...^.^.^.....^.^.^...^.^.^.^.^.^.
............................................................................................................................................."""
part1_asserts = [
    (inp, 1543),
]
part2_asserts = [
    (inp, 3223365367809),
]


def part1(inp: str) -> str | int | None:
    result = 0
    origins = []
    matrix = []
    for line in inp.splitlines():
        matrix.append(list(line))
    for c in matrix[0]:
        if c == "S":
            origins.append([matrix[0].index(c)])
    for r in range(1, len(matrix)):
        ori = []
        hits = origins[r - 1].copy()
        for c in range(len(matrix[r])):
            if matrix[r][c] == "^":
                for o in origins[r - 1]:
                    if c == o:
                        result += 1
                        hits.remove(c)
                ori.append(c + 1)
                ori.append(c - 1)
        if len(ori) == 0:
            ori = (origins[r - 1])
        if len(hits) > 0:
            for h in hits:
                ori.append(h)
        origins.append(list(dict.fromkeys(ori)))
        ori = []
    return result


def part2(inp: str) -> str | int | None:
    lines = inp.splitlines()
    h = len(lines)

    grid = set()
    s = (0, 0)

    for y, l in enumerate(lines):
        for x, c in enumerate(l):
            if c == "^":
                grid.add((x, y))
            elif c == "S":
                s = (x, y)

    tips = defaultdict(int)
    tips[s[0]] = 1

    for y in range(s[1] + 1, h):
        if not any((x, y) in grid for x in tips):
            continue

        next_tips = defaultdict(int)
        for x, count in tips.items():
            if (x, y) in grid:
                next_tips[x - 1] += count
                next_tips[x + 1] += count
            else:
                next_tips[x] += count

        tips = next_tips
        if not tips:
            break
    return sum(tips.values())
